---
id: HTTPTheDefinitiveGuide
title: 《HTTP 权威指南》
---

## 第一部分 HTTP：Web 的基础

### 第 1 章 HTTP 概述

1. HTTP 含义：超文本传输协议，是基于 TCP 的可靠数据传输协议。
2. 服务器与资源关系：Web 服务器是 Web 资源的宿主。
3. `MIME` 多媒体类型
    1. 含义：是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔；
    2. 常见类型：`text/html`、`text/plain`、`image/jpeg` 等；
    3. 标识位置：`Content-Type`；
    4. 应用场景：HTTP 对每种要通过 Web 传输的对象都打上了 `MIME` 类型。
4. URL：统一资源地址定位符。
5. 请求方法
    1. 含义：通过不同的请求命令来告诉服务器所执行的行为；
    2. 常用方法：`GET`、`PUT`、`DELETE`、`POST`、`HEAD` 等。
6. 状态码
    1. 含义：响应状态码，告诉客户端应采取的行为。
7. 报文结构
    1. 组成：起始行、首部字段（首部以空行结束）、主体三部分；
    2. 类型：请求报文和响应报文；
    3. 请求报文：
        1. 组成：请求行（方法、目标、协议版本）、请求头（空行）、实体（给服务器的数据）。
        2. 结构：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703402855475-3768171d-7360-4dbe-8cb8-c628a8247efb.png)
    4. 响应报文：
        1. 组成：状态行（版本号、状态码、原因）、响应头（头部字段，如：`Date`、`Content-Type`、`Last-Modified`）、实体（返回客户端的数据）。
        2. 结构：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703402872553-d8d4bb45-7f31-481d-b896-28b181e2228d.png)
    5. 图示![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703407467999-5ebc5fc4-9efe-4353-8c04-de35d5653360.png)
8. TCP 优势
    1. 无差错的数据传输；
    2. 按序传输（数据总是会按照发送的顺序到达）；
    3. 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）。
9. 基本的浏览器处理
    1. DNS 解析：将域名地址解析成 IP 地址；
    2. TCP 连接，即“三次握手”；
    3. 浏览器发送 HTTP 请求报文；
    4. 服务器处理请求，并响应 HTTP 响应报文；
    5. 浏览器解析渲染页面：
        1. HTML → Dom Tree；
        2. CSS → CSSOM Tree；
        3. JavaScript 引擎解析 JavaScript 代码；
        4. Dom Tree + CSSOM Tree = Render Tree；
        5. Render。
    6. 页面关闭，TCP 断开连接，即“四次挥手”。
10. 各版本特性
    1. HTTP/0.9：只支持 `GET` 方法，不支持 `MIME`、各种 HTTP 首部、版本号，很快被取代；
    2. HTTP/1.0：支持额外的方法，支持添加版本号、支持各种首部、以及对多媒体对象的处理，第一个广泛使用的版本；
    3. HTTP/1.1：支持 `Keep-Alive` 连接、虚拟主机支持、代理连接支持，校正结构缺陷；
    4. HTTP/2.0：关注性能优化。
11. HTTP 各版本差异
    1. HTTP/1.1 —— HTTP/1.0
        1. 长连接：HTTP/1.0 使用短连接（每进行一次 HTTP 操作，就建立一次连接，任务结束就中断连接），需要使用 `Keep-Alive` 参数来告知服务器端要建立一个长连接，而 HTTP/1.1 默认支持长连接。（HTTP 是基于 `TCP/IP` 协议的，创建一个 TCP 连接是需要经过三次握手的，有一定的开销，如果每次通讯都要重新建立连接的话，对性能有影响。因此最好能维持一个长连接，可以用一个长连接来发多个请求）
        2. 节约带宽：HTTP/1.1 支持只发送 `Header` 信息(不带任何 `Body` 信息)，如果服务器认为客户端有权限请求服务器，则返回 100，否则返回 401。客户端如果接收到 100，才开始把请求 `Body` 发送到服务器。这样当服务器返回 401 的时候，客户端就可以不用发送请求 `Body` 了，节约了带宽。
        3. Host 域：HTTP/1.0 是没有 Host 域的，HTTP/1.1 才支持这个参数。（记录网站 IP 地址和域名映射关系的系统文件。作用：加快域名解析——跳过 DNS 域名解析步骤）
        4. 缓存：HTTP/1.1 支持 `Cache-Control` 机制。
    2. HTTP/2.0 —— HTTP/1.1
        1. 多路复用：HTTP/2.0 使用了多路复用（帧乱序，依照 `Stream` 流传，传后再做拼接）的技术，做到同一个连接并发处理多个请求，而且并发请求的数量比 HTTP/1.1 大了好几个数量级。
        2. 二进制分帧：在应用层（HTTP/2.0）和传输层（TCP/UDP）之间增加一个二进制分帧层。（将传输的消息分割成更小的消息和帧，并对其进行二进制编码，首部封装到 `Header` 帧，请求体封装到 `Data` 帧）
        3. 首部压缩：HTTP/1.1 不支持 `Header` 数据压缩，HTTP/2.0 对 `Header` 的数据进行压缩。
        4. 服务器推送：在 HTTP/2.0 中，服务器可以对客户端的一个请求发送多个响应。（可以额外的向客户端推送资源，客户端可以缓存这些资源，由不同页面共享——遵循同源策略）
        5. 安全：HTTP/2.0 是基于 HTTPS，天然具有安全性。
12. 代理：位于客户端和服务器之间，接收所有客户端 HTTP 请求，并转发给服务器。
13. 缓存
    1. 含义：特殊的 HTTP 代理服务器，将经过的文档内容进行复制保存；
    2. 作用：提高未来访问已缓存资源的效率。
14. 网关
    1. 含义：特殊服务器，作为其他服务器的中间实体使用；
    2. 作用：通常用于将 HTTP 流量转换成其他的协议。
    3. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403008588-49017808-6c7e-4161-8844-f5d649be57b6.png)
15. 隧道
    1. 理解一：在两条连接之间对原始数据进行盲转发的 HTTP 应用程序。通常用来在一条或多条 HTTP 连接上转发非 HTTP 数据，转发时不会窥探数据；
    2. 理解二：是一种利用 HTTP 或 HTTPS 把多种网络协议封装起来进行通信的技术。理解成网络协议管道的包装器，将其他协议的请求掩盖成 HTTP 的请求。
    3. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403043123-1e8d9db2-981c-481b-8a1f-c7b188665003.png)

### 第 2 章 URL 与资源

1. URI 统一资源地址标识符
    1. 组成
        1. URL：统一资源地址定位符，描述资源的定位；
        2. URN：统一资源名称，描述资源的名称，无法定位到具体位置。
2. 通用 URL 组件
    1. 组成：方法、用户、密码、主机、端口、路径、参数、查询、片段。
    2. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703408157734-0be0f9f4-330c-4e72-9a87-a01b429e415a.png)
3. URL 分类：绝对 URL 和相对 URL。
4. URL 相对路径转绝对路径思路
    1. 寻找基础 URL
        1. 一些在资源中显式提供，如 `<BASE>` 标签包裹；
        2. 资源中未显式提供，却存在相对 URL，可将其所属资源的 URL 作为基础。
    2. 解析相对引用：将相对 URL 和基础 URL 划分成组件段；
    3. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703407510861-aefb7d27-d8eb-4143-960e-cf8b54f92131.png)

### 第 3 章 HTTP 报文

1. `GET` 方法：请求获取资源。
2. `HEAD` 方法
    1. 表现：响应只返回首部，不返回实体。
    2. 作用：
        1. 在不获取资源的情况下了解资源的情况（比如，判断其类型）；
        2. 通过查看响应中的状态码，看看某个对象是否存在；
        3. 通过查看首部，测试资源是否被修改了。
3. `PUT` 方法：向服务器写入资源。
4. `POST` 方法：向服务器推送数据（如表单数据提交）。
5. `TRACE` 方法
    1. 表现：穿过防火墙、代理、网关等来请求服务器，并回显其收到的请求信息（每个中间节点都可能会修改原始的 HTTP 请求，通过响应形成“回环”检测，分析响应上原始报文是否被修改）；
    2. 作用：用于对 HTTP 请求的测试或诊断。
    3. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703407531965-ad3e5799-86e7-47a2-9468-cfd38a7df046.png)
6. `OPTIONS` 方法
    1. 作用：请求服务器，响应服务器所支持的各种请求方法。
    2. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403288974-845f8e8e-22a2-43b0-b272-da22f5ea351b.png)
7. `DELETE` 方法：请求服务器删除指定 URL 资源（服务器有权在不通知客户端情况下撤销请求）。
8. 拓展方法：HTTP/1.1 中没有规范定义的方法
    1. `LOCK`：允许用户“锁定”资源——比如，可以在编辑某个资源的时候将其锁定，以防别人同时对其进行修改；
    2. `MKCOL`：允许用户创建资源；
    3. `COPY`：便于在服务器上复制资源；
    4. `MOVE`：在服务器上移动资源。
9. 安全方法：在服务器上不产生什么结果（`GET`、`HEAD`）。
10. 常用 HTTP 方法中，只有 `POST` 和 `PUT` 包含主体。
11. 首部分类
    1. 通用首部：
        1. 含义：既可以出现在请求报文中，也可以出现在响应报文中；
        2. 例子：`Date`、`Connection`、`Update`、`Cache-Control`、`Pragma` 等。
    2. 请求首部：
        1. 含义：提供更多有关请求的信息；
        2. 例子：`Accept`、`Accept-Charset`、`Accept-Encoding`、`Accept-Language`、`Host`、`Referer`、`User-Agent`、`Expect`、`If-Match`、`If-Modified-Since`、`If-None-Match`、`If-Unmodified-Since`、`Authorization`、`Cookie` 等。
    3. 响应首部：
        1. 含义：提供更多有关响应的信息；
        2. 例子：`Age`、`Server`、`Proxy-Authenticate`。
    4. 实体首部：
        1. 含义：描述主体的长度和内容，或者资源自身；
        2. 例子：`Allow`、`Location`、`Content-Encoding`、`Content-Language`、`Content-Length`、`Content-Location`、`Content-Type`、`E-Tag`、`Expires`、`Last-Modified` 等。
    5. 扩展首部：
        1. 含义：规范中没有定义的新首部。

### 第 4 章 连接管理

1. HTTPS 区别于 HTTP：HTTPS 是在四层网络模型中 HTTP 层和 TCP 层中加了 SSL 或 TLS 密码加密层。
    1. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403334026-daaa829f-12e7-4bd4-87ff-6f5e5700192c.png)
2. 报文传输方式：HTTP 报文以流 `Stream` 的形式进入 TCP 连接中，TCP 对数据切分成段封装在 IP 分组（ IP 数据报）中进行传输。
3. TCP 连接识别依据：源 IP 地址、源端口号、目的 IP 地址、目的端口号。
    1. 图示：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403351268-366ae08a-1fe7-402a-9755-32ec5a31dab5.png)
4. HTTP 时延造成原因
    1. DNS 域名解析时延；
    2. TCP 连接请求时延；
    3. TCP 服务器回送响应时延；
    4. 数据传输时延；
    5. 服务器数据处理时延。
5. 握手导致的时延：通常 HTTP 事务都不会交换太多数据，此时，`SYN/SYN+ACK` 握手所产生的时延，对于一些小的 HTTP 事务来说，花在 TCP 建立上的时间占比可能达到 50%或者更多。
6. 延迟确认：因特网无法保证可靠的分组传输，传输过程中会出现丢包情况，所以 TCP 实现了自己的确认机制。每个 TCP 段都有序列号和数据完整的校验和，接收方收到数据需要向发送方发送确认报文，确认报文很小，通常被捎带在朝相反方向输出的数据分组中。
7. “延迟确认”算法：在一个特定的窗口时间（通常是 100 ～ 200 毫秒）内，将输出确认存放在缓冲区中，寻找能够捎带它的输出数据分组。若时间段内没有输出数据分组，就将确认信息放在单独的分组中传送。
8. 慢启动：传输初始限制传输速度，随着传输进行，逐步提高传输速度，用于防止因特网的突然过载和拥塞。
9. 拥塞控制：控制发送分组数量，成功发送一个后，等待确认后则发送两个，逐步翻倍，以此类推。
10. `Nagle` 算法
    1. 背景：TCP 有一个数据流接口，应用程序可以通过它将任意尺寸的数据放入 TCP 栈中——即使一次只放一个字节也可以。但是，每个 TCP 段中都至少装载了 40 个字节的标记和首部，所以如果 TCP 发送了大量包含少量数据的分组，网络的性能就会严重下降；
    2. 作用：`Nagle` 鼓励发送全尺寸（LAN 上最大尺寸的分组大约是 1500 字节，在因特网上是几百字节）的段，若还有其他分组仍然在传输，就会将数据暂时缓存，当缓存数据量达到全尺寸分组的数据时，才发送出去；
    3. 弊端：`Nagle` 算法会阻止数据的发送，直到有确认分组抵达，但确认分组自身会被延迟确认算法延迟 100 ～ 200 毫秒。
11. `Connection` 首部
    1. 场景：在客户端和源服务器之间会存在一些 HTTP 中间实体（高速缓存、代理），相邻两个实体会为共用的连接应用一组选项，`Connection` 携带连接标签列表，在源端服务器发出携带 `Connection` 的响应被经过的第一个中间实体解析以后会被移除，再将移除后的响应转发给下一实体。
    2. 作用：
        1. 控制不再转发给下一 HTTP 中间实体的首部字段；
        2. 管理持久连接。
    3. 示意图：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403419648-99dd3259-bd5e-424e-8acc-878ea9932a4c.png)
    4. 一些类似的也会被移除不能被代理转发的首部：`Prxoy-Authenticate`、`Proxy-Connection`、`Transfer-Encoding` 和 `Upgrade`。
12. 提高 HTTP 连接性能的处![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703408134947-4f5336d5-fb74-428f-82ea-9e59fffe1b2e.png)
    1. 并行连接
        1. 方式：通过多条 TCP 连接发起并发的 HTTP 请求；
        2. 优化原理：请求并行，时延重叠。
    2. 持久连接
        1. 含义：事务处理结束之后仍然保持在打开状态的 TCP 连接；
        2. 方式：开启 `Keep-Alive` 首部，保持 TCP 连接，持续发起 HTTP 请求；
        3. 优化原理：消除 TCP 连接及关闭时延，避开慢启动的拥塞适应阶段；
        4. 规则/限制：
            1. HTTP/1.1 的代理需具备分别管理客户端和服务器的持久连接；
            2. HTTP/1.1 设备可以在任意时刻关闭连接；
            3. 除非重复发起请求会有副作用，否则若在客户端收到整条响应之前关闭连接，客户端必须重新发起请求；
            4. 一个客户端对任意服务器/代理最多为 `2` 条持久连接，防止服务器过载。代理需面对 `N` 个客户端，所以最多需要维护 `2N` 到父代理或服务器的持久连接。
        5. `Keep-Alive` 首部：
            1. 含义：长链接的标识；
            2. 版本差异：HTTP/1.0 需要手动在请求头中加入 `Connection：Keep-Alive`，HTTP/1.1 默认支持。
            3. 参数
                1. `timeout`
                    1. 发送方：响应首部；
                    2. 作用：服务器希望此连接保持活跃状态的时间，非承诺值。
                2. `max`
                    1. 发送方：响应首部；
                    2. 作用：服务器希望再为多少个事务保持此连接的活跃状态，非承诺值。
    3. 管道化连接
        1. 方式：在持久连接基础上，共享 TCP 连接，维护请求队列形成管道，发起并发的 HTTP 请求；
        2. 优化原理：保持连接，交替传送请求/响应报文，降低网络回环时间；
        3. 规则/限制：
            1. 客户端无法确认连接是持久的，则不使用管道；
            2. 请求和响应需顺序一致，否则无法匹配；
            3. 客户端做好连接随时被关闭的准备，准备好重发未完成的管道请求；
            4. 客户端不应该使用管道化方式发送会产生副作用的请求（如 POST 出错，无法安全重试此类非幂等请求）。
13. 逐跳首部
    1. 含义：只适用于单条传输链路，不沿着传输链路向下传输的首部；
    2. 理解：只对单次转发有效，会因为通过代理或缓存而不再进行转发；
    3. 范围：`Connection` 及其值、`Prxoy-Authenticate`、`Proxy-Connection`、`Transfer-Encoding` 和 `Upgrade`。
14. 客户端连接关闭预防：连接随时有可能被关闭，需检测数据长度是否能和 `Content-Length` 匹配上，如缓存代理检测到其不匹配，则不应该缓存该信息，防止未来出现缓存内容和新内容拼接不正确的问题，同时，将该信息原封不动传输给客户端。
15. 连接关闭的不同情况![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403517065-34fcb536-39f8-4214-89e0-73ae58d96962.png)
    1. 完全关闭：输入输出信道均关闭，安全。
    2. 半关闭：
        1. 输出信道关闭：安全。对端会在缓存区收到通知，知道流结束，即知对向连接关闭。
        2. 输入信道关闭：危险。对端不知道你不再接收数据，而发送过来请求，你会自动回送一条 TCP “连接被对端重置”的报文，这会导致操作系统清空当前缓存区数据，当最终要去读取关闭信道之前已缓存的数据时，得不到数据，且收到连接被对端重置的错误。
16. 幂等性
    1. 计算机学：事务无论多次操作或一次操作，返回结果相同；
    2. 特指前端：Web 中发起多次 HTTP 请求返回值不变
        1. 幂等：`GET`、`PUT`、`HEAD`、`DELETE`、`TRACE`、`OPTIONS` 或数据库操作 `SELETE` 等；
        2. 非幂等：`POST`、`UPDATE` 等（非幂等方法不可随意重试，容易造成数据出错）。

## 第二部分 HTTP 结构

### 第 5 章 Web 服务器

1. Web 服务器基本任务![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403805175-ea207985-1714-44fa-b57d-2a2fbae4bff1.png)
    1. 建立连接——接收客户端连接；
    2. 接收请求——读取 HTTP 请求报文；
    3. 处理请求——解释请求报文，并操作；
    4. 访问资源——访问报文指定资源；
    5. 构建响应——创建 HTTP 响应报文；
    6. 发送响应——将响应回送给客户端；
    7. 记录日志——事务有关内容记录日志文件。
2. 建立连接
    1. 从 TCP 中解析 IP 地址；
    2. 反向 DNS 识别：
        1. DNS ：是域名解析为 IP 地址；
        2. 反向 DNS（或 rDNS）：是将 IP 地址解析为域名，主要用于访问控制和日志记录；
        3. （拓展：“双向 DNS ”，是与目标 IP 处于同一个网段时，显示内网 IP，与目标 IP 不处于同一个网段时，显示外网 IP 。实现内网主机和外网主机访问同一网站域名，定义到不同服务器。）
    3. 服务器通过 `ident` 协议确定客户端用户。
3. 接收请求
    1. 报文内部表示法：Web 服务器生成便于操作请求报文的内部数据结构来存储请求报文（如数据结构中含指针、长度等，来快速指向特定首部）。
    2. 输入/输出处理结构：![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403837655-55ff4979-a49b-481a-8ce0-8b9b65e42962.png)
        1. 单线程 Web 服务器
            1. 特点：一次处理一请求；
            2. 优势：易于实现；
            3. 弊端：串行，性能差。
        2. 多进程及多线程 Web 服务器
            1. 特点：多进程或多线程并行处理；
            2. 优势：高效；
            3. 弊端：连接条数数量级高时，耗资源；
        3. 复用 I/O 服务器
            1. 特点：监视所有连接，只处理有状态变化的连接；
            2. 优势：相对高效；
            3. 弊端：若单线程压力大。
        4. 复用多线程 Web 服务器
            1. 特点：结合多线程和复用，利用多 CPU 上每个 CPU 而带来的多线程；
            2. 优点：`N \* M` 结构，能处理的请求更多，每个 M 所有处理的请求数量减少，效率最高。
4. Web 服务器确定响应主体拓展名的确认方式
    1. `MIME` 方式：服务器直接根据资源后缀在包含所有拓展名的 `MIME` 类型的文件进行扫描匹配，来确定 `MIME` 类型；
    2. 魔法分类：服务器扫描资源内容，来与一个已知模式表进行匹配，从而决定 `MIME` 类型；
        1. 优点：文件没有标准扩展名也能确定 `MIME` 类型；
        2. 缺点：扫描速度慢；
    3. 显式分类：对服务器进行配置，强制特定文件或目录为某个 `MIME` 类型；
    4. 类型协商：一些服务器可以使用多种格式存储资源，这种情况下，可通过与用户协商方式来决定选择哪种格式。
5. 重定向应用场景
    1. 永久搬离的资源；
    2. 临时搬离的资源；
    3. URL 增强：常用于嵌入上下文，请求到达时生成新的 URL，该 URL 包含嵌入式状态的信息，最后将用户重定向到新的 URL 上并再次重新发起请求；
    4. 负载均衡：某台服务器超载，将客户端重定向到另一台负载不太重的服务器上；
    5. 服务器关联：服务器可能会存储某些用户的本地信息，服务器可以将客户端重定向到存储对应用户信息的服务器上；
    6. 规范目录名称：当请求 URI 是不带尾部斜线的目录名时，多数服务器会将客户端重定向到一个加了斜线的 URI 上，以保证相对链接正常工作。
6. 常见 Web 服务器软件![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403879833-823f7fb0-abfd-4ce7-b5ba-05f0b540d7d3.png)

### 第 6 章 代理

1. 代理服务器
    1. 定义：是客户端和服务器的中间媒介，既支持服务器的响应功能，也具备客户端发起请求的功能，提供诸如缓存等优化服务；
    2. 优势：改善安全性，提高性能，流量监控；
    3. 应用场景
        1. 儿童过滤器![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403902828-4b8b666f-bf3f-46c7-b497-e4479de266ca.png)
        2. 访问权限控制![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403934497-abeaa8fe-7e58-4e72-afbe-8adeb44ff531.png)
        3. 安全防火墙![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403948378-12ed4f2d-4ece-4652-91c9-ec45b46f52c5.png)
        4. Web 缓存![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403969020-8eb6d7af-ad5b-4da5-8d52-2f4082ec4af8.png)
        5. 反向代理![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703403983614-56d9f6c2-7afe-40af-9c8c-f1ee378c7d2a.png)
        6. 内容路由器：如提供付费高速等![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703404002901-1e7c0474-bd0f-4311-87c0-801c068f9c9f.png)
        7. 转码器：数据格式转换，如 Gif → Jpeg 等![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703404018625-cf563f52-3aff-4023-a627-aecfd505acf7.png)
        8. 匿名者：主动删除 HTTP 上的身份特性提高私密性，如 `Referer`、`Cookie`、IP 地址等![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703404034764-4582122d-302e-4ef9-91c7-da125a0499b4.png)
2. 私有/公共代理：区别在于是否为某一客户端专享。大多数为公有共享代理。
3. 代理和网关区别：代理连接相同协议的应用程序；网关连接不同协议，起到协议转换的作用。（现代代理面对不同的 HTTP 协议版本，通常也具备协议转换的能力，以便支持 SSL、FTP 访问等）![](https://cdn.nlark.com/yuque/0/2023/png/25855170/1703404060633-021e13e8-398f-4d03-abc8-30b781e1b7ad.png)
4. 代理层次结构：越靠近客户端为子，越靠近服务器为父。
    1. 静态：按照固定路线走代理；
    2. 动态：根据不同情况将请求报文转发给不固定的代理（如付费用户，走 CDN 代理等）；
        1. 动态选择父代理场景：负载均衡、地理位置附近的路由、协议/类型路由（特定 URI 需要通过特定类型父代理转发请求，进行特殊协议处理）、基于订购的路由（付费用户 URI 转发到大型缓存或压缩引擎上）。
